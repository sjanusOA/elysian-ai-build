/* Elysian Build - Optimized JavaScript */
let currentSlideIndex=0,sliderInterval;const slides=document.querySelectorAll('.slide'),dots=document.querySelectorAll('.dot'),totalSlides=slides.length;

function loadSlideImages(){slides.forEach((slide,index)=>{const bg=slide.dataset.bg;if(bg){const img=new Image();img.onload=()=>{slide.style.backgroundImage=`url(${bg})`};img.src=bg}})}

function initHeroSlider(){loadSlideImages();sliderInterval=setInterval(()=>changeSlide(1),6000);let startX=0,endX=0;const hero=document.querySelector('.hero');
hero.addEventListener('touchstart',e=>{startX=e.touches[0].clientX});
hero.addEventListener('touchend',e=>{endX=e.changedTouches[0].clientX;handleSwipe()});
function handleSwipe(){const swipeThreshold=50,diff=startX-endX;Math.abs(diff)>swipeThreshold&&(diff>0?changeSlide(1):changeSlide(-1))}}

function changeSlide(direction){slides[currentSlideIndex].classList.remove('active');dots[currentSlideIndex].classList.remove('active');currentSlideIndex+=direction;
currentSlideIndex>=totalSlides?currentSlideIndex=0:currentSlideIndex<0&&(currentSlideIndex=totalSlides-1);
slides[currentSlideIndex].classList.add('active');dots[currentSlideIndex].classList.add('active')}

function currentSlide(slideNumber){slides[currentSlideIndex].classList.remove('active');dots[currentSlideIndex].classList.remove('active');currentSlideIndex=slideNumber-1;
slides[currentSlideIndex].classList.add('active');dots[currentSlideIndex].classList.add('active')}

function pauseSlider(){clearInterval(sliderInterval)}
function resumeSlider(){sliderInterval=setInterval(()=>changeSlide(1),6000)}

const hero=document.querySelector('.hero');
hero.addEventListener('mouseenter',pauseSlider);
hero.addEventListener('mouseleave',resumeSlider);

document.addEventListener('DOMContentLoaded',()=>{
    initHeroSlider();
    const hamburger=document.querySelector('.hamburger'),navMenu=document.querySelector('.nav-menu');
    hamburger&&hamburger.addEventListener('click',()=>{hamburger.classList.toggle('active');navMenu.classList.toggle('active')});
    document.querySelectorAll('.nav-link').forEach(link=>{link.addEventListener('click',()=>{hamburger.classList.remove('active');navMenu.classList.remove('active')})});
    
    window.addEventListener('scroll',()=>{
        const navbar=document.querySelector('.navbar');
        navbar.style.background=window.scrollY>50?'rgba(255,255,255,.98)':'rgba(255,255,255,.95)';
    });
    
    const observerOptions={threshold:.1,rootMargin:'0px 0px -50px 0px'};
    const observer=new IntersectionObserver((entries)=>{entries.forEach(entry=>{entry.isIntersecting&&entry.target.classList.add('animate')})},observerOptions);
    document.querySelectorAll('.service-card,.portfolio-cell,.testimonial-card').forEach(el=>observer.observe(el));
    
    // Lazy load portfolio images
    const portfolioImages=document.querySelectorAll('.portfolio-cell img');
    const imageObserver=new IntersectionObserver((entries,observer)=>{
        entries.forEach(entry=>{
            if(entry.isIntersecting){
                const img=entry.target;
                if(img.dataset.src){
                    img.src=img.dataset.src;
                    img.removeAttribute('data-src');
                }
                imageObserver.unobserve(img);
            }
        });
    });
    portfolioImages.forEach(img=>imageObserver.observe(img));
});
